#!/bin/openrc-run
#
# $FreeBSD$
#
#  # optional
#  postgresql_data="%%PREFIX%%/%%PG_USER%%/data"
#  postgresql_flags="-w -s -m fast"
#  postgresql_initdb_flags="--encoding=utf-8 --lc-collate=C"
#  postgresql_class="default"
#  postgresql_profiles=""
#
# See %%PREFIX%%/share/doc/postgresql/README-server for more info
#
# This scripts takes one of the following commands:
#
#   start stop restart status initdb
#
# For postmaster startup options, edit ${postgresql_data}/postgresql.conf

# set defaults
postgresql_flags=${postgresql_flags:-"-w -s -m fast"}
postgresql_user=${postgresql_user:-"%%PG_USER%%"}
eval postgresql_data=${postgresql_data:-"~${postgresql_user}/data"}
postgresql_class=${postgresql_class:-"default"}
postgresql_initdb_flags=${postgresql_initdb_flags:-"--encoding=utf-8 --lc-collate=C"}

command="%%PREFIX%%/bin/pg_ctl"
command_user="${postgresql_user}"
command_args="-D ${postgresql_data} ${postgresql_flags}"
name=postgresql

depend()
{
	need localmount
	keyword -shutdown -stop
}

extra_commands="initdb"

initdb()
{
    su -l -c ${postgresql_class} ${postgresql_user} -c "exec %%PREFIX%%/bin/initdb ${postgresql_initdb_flags} -D ${postgresql_data} -U ${postgresql_user}"
}
